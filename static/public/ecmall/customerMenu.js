window.gMenu = {"default": {"name": "\u5feb\u6377\u83dc\u5355", "url": "#", "_children_": {"order": {"name": "\u8ba2\u5355", "icoClass": "function", "_children_": {"check": {"name": "\u6d88\u8d39\u9a8c\u8bc1", "icoClass": "", "url": "?m=ecmall.customer&c=order&a=check"}, "admin": {"name": "\u8ba2\u5355\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=order"}, "purchase": {"name": "\u5185\u8d2d\u67e5\u8be2", "icoClass": "", "url": "?m=ecmall.customer&c=order&a=purchase"}, "chargeback": {"name": "\u9000\u5355\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=order&a=service"}, "details": {"name": "\u6d88\u8d39\u660e\u7ec6", "icoClass": "", "url": "?m=ecmall.customer&c=order&a=consumer.details"}}}, "goods": {"name": "\u4ea7\u54c1", "icoClass": "function", "_children_": {"admin": {"name": "\u4ea7\u54c1\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=goods"}, "stageaddr": {"name": "\u9a7f\u7ad9\u5730\u5740\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=stageaddr"}, "goodscategory": {"name": "\u4ea7\u54c1\u5206\u7c7b", "icoClass": "", "url": "?m=ecmall.customer&c=goodscategory"}, "tag": {"name": "\u4ea7\u54c1\u6807\u7b7e", "icoClass": "", "url": "?m=ecmall&c=goods&a=tag"}}}, "hotelManager": {"name": "\u9152\u5e97\u7ba1\u7406", "icoClass": "function", "_children_": {"hotel": {"name": "\u623f\u578b\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=hotel.goods"}, "order": {"name": "\u8ba2\u5355\u5904\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=hotel.order"}, "priceAdjust": {"name": "\u53d8\u4ef7\u7ef4\u62a4", "icoClass": "", "url": "?m=ecmall.customer&c=hotel.price.manager&a=adjust"}, "priceAdjustList": {"name": "\u53d8\u4ef7\u8bb0\u5f55\u67e5\u8be2", "icoClass": "", "url": "?m=ecmall.customer&c=hotel.price.manager"}, "roomstatusManage": {"name": "\u623f\u6001\u7ef4\u62a4", "icoClass": "", "url": "?m=ecmall.customer&c=roomstatus&a=manage"}, "roomquanty": {"name": "\u623f\u91cf\u7ef4\u62a4", "icoClass": "", "url": "?m=ecmall.customer&c=roomquanty&a=manage"}, "roomstatus": {"name": "\u623f\u6001\u67e5\u8be2", "icoClass": "", "url": "?m=ecmall.customer&c=roomstatus&a=search"}}}}}, "finance": {"name": "\u8d22\u52a1", "url": "#", "_children_": {"store": {"name": "\u5546\u5bb6\u8d22\u52a1\u7ba1\u7406", "icoClass": "function", "_children_": {"reconciliation": {"name": "\u5bf9\u8d26\u53ca\u7ed3\u7b97", "icoClass": "", "url": "?m=ecmall.customer&c=reconciliation"}}}}}, "system": {"name": "\u7cfb\u7edf\u8bbe\u7f6e", "url": "#", "_children_": {"admin": {"name": "\u7cfb\u7edf\u7ba1\u7406", "icoClass": "function", "_children_": {"store": {"name": "\u5e97\u94fa\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall&c=store"}, "role": {"name": "\u89d2\u8272\u6743\u9650", "icoClass": "", "url": "?m=ecmall&c=role"}, "menu": {"name": "\u91cd\u7f6e\u83dc\u5355", "icoClass": "", "url": "?m=ecmall&a=customer.menu"}}}, "system": {"name": "\u8fd0\u8425\u7ba1\u7406", "icoClass": "function", "_children_": {"user": {"name": "\u4f1a\u5458\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall&c=user"}, "role": {"name": "\u89d2\u8272\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall&c=role"}, "qrscene": {"name": "\u5546\u6237\u4e8c\u7ef4\u7801", "icoClass": "", "url": "?m=ecmall.customer&c=wx&a=qrscene"}, "purchase": {"name": "\u5185\u8d2d\u8bbe\u7f6e", "icoClass": "", "url": "?m=ecmall.customer&c=goods&a=purchase"}, "card": {"name": "\u5361\u5238\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=card&a=feedback"}}}, "store": {"name": "\u5546\u94fa\uff08\u5e97\u94fa\uff09", "icoClass": "function", "_children_": {"info": {"name": "\u5e97\u94fa\u7ba1\u7406", "icoClass": "", "url": "?m=ecmall.customer&c=store&a=info"}}}, "dataCenter": {"name": "\u6570\u636e\u4e2d\u5fc3", "icoClass": "function", "_children_": {"statistical": {"name": "\u7528\u6237\u7edf\u8ba1", "icoClass": "", "url": "?m=ecmall.customer&c=statistical&a=visitor"}, "feedback": {"name": "\u7528\u6237\u53cd\u9988", "icoClass": "", "url": "?m=ecmall.customer&c=feedback&a=statistics"}, "product": {"name": "\u4ea7\u54c1\u7edf\u8ba1", "icoClass": "", "url": "?m=ecmall.customer&c=statistical&a=product"}}}, "gameSet": {"name": "\u6e38\u620f\u914d\u7f6e", "icoClass": "function", "_children_": {"treeTypeSet": {"name": "\u679c\u6811\u7c7b\u578b\u914d\u7f6e", "icoClass": "", "url": "?m=ecmall.customer&c=tree.game&a=type.set"}, "treeSet": {"name": "\u679c\u6811\u914d\u7f6e", "icoClass": "", "url": "?m=ecmall.customer&c=tree.game&a=set"}}}}}};
/*计算高度*/
function resizeHeight() {

    var iSide = $(window).height() - 50;
    $(".main").height(iSide);
}

$(function () {
    var aHtml = [];
    var iIndex = 0;
    var menu = window.gMenu;
    var aPur = {"1": "default_order_check,default_order_admin,default_order_purchase,default_order_chargeback,default_goods_admin,default_hotelManager_hotel,default_hotelManager_order,default_hotelManager_priceAdjust,default_hotelManager_priceAdjustList,default_hotelManager_roomstatusManage,default_hotelManager_roomquanty,default_hotelManager_roomstatus,system_admin_store,system_admin_role", "2": "default_order_check,default_order_purchase,default_goods_admin,default_hotelManager_hotel,default_hotelManager_order,default_hotelManager_priceAdjust,default_hotelManager_priceAdjustList,default_hotelManager_roomstatusManage,default_hotelManager_roomquanty,default_hotelManager_roomstatus,system_admin_store,system_admin_role", "128": "default_order_check,default_order_admin,default_order_purchase,default_order_chargeback,default_order_details,default_goods_admin,default_goods_stageaddr,default_goods_goodscategory,default_goods_tag,default_hotelManager_hotel,default_hotelManager_order,default_hotelManager_priceAdjust,default_hotelManager_priceAdjustList,default_hotelManager_roomstatusManage,default_hotelManager_roomquanty,default_hotelManager_roomstatus,finance_store_reconciliation,system_admin_store,system_admin_role,system_admin_menu,system_system_user,system_system_qrscene,system_system_purchase,system_system_card,system_store_info,system_dataCenter_statistical,system_dataCenter_feedback,system_dataCenter_product,system_gameSet_treeTypeSet,system_gameSet_treeSet"};
    var iPur = parseInt(window.gPurview);
    for (var pur in aPur) {
        aPur[pur] = ',' + aPur[pur] + ',';
    }
    for (var i in menu) {
        for (var j in menu[i]['_children_']) {
            var mObj = menu[i]['_children_'][j]['_children_'];
            var aMenu = [] , aMenus = [];

            aMenu[aMenu.length] = '<a href="javascript:;"><i class="glyphicon glyphicon-th-large ' + menu[i]['_children_'][j]['icoClass'] + '"></i><span class="title">' + menu[i]['_children_'][j]['name'] + '</span><span class="glyphicon glyphicon-chevron-down arrows"></span></a>';
            for (var k in mObj) {
                var sId = [i, j, k].join('_');
                for (var pur in aPur) {
                    if ((iPur & pur) && aPur[pur].indexOf(',' + sId + ',') > -1) {
                        aMenu[aMenu.length] = '<li id="' + sId + '" class="menu_item ' + mObj[k]['icoClass'] + '"><a href="' + mObj[k]['url'] + '">' + mObj[k]['name'] + '</a></li>';
                        break;
                    }
                }
            }

            for (var m = 1; m < aMenu.length; m++) {
                aMenus[aMenus.length] = aMenu[m];
            }

            if (aMenu.length > 1) {
                aHtml[aHtml.length] = '<li class="menu-newmall closed">';
                aHtml[aHtml.length] = aMenu[0];
                aHtml[aHtml.length] = '<ul class="sub-menu">' + aMenus.join('');
                aHtml[aHtml.length] = '</ul></li>';
            }
        }
    }

    var omenus = '<li> <div class="sidebar-toggler hidden-phone"></div> </li>';
    $('#menuBar').html(omenus + aHtml.join(''));
    var fLoadSelected = function () {
        if (typeof window.gMenuIndex == 'undefined') {
            setTimeout(fLoadSelected, 50);
        } else {
            $('#menuBar DL').click(function () {
                $(this).toggleClass('closed');
            });
            $('#' + window.gMenuIndex).addClass('selected').parent().parent().removeClass('closed').addClass('open').addClass('firstopen').find(".arrows").removeClass('glyphicon-chevron-down').addClass('glyphicon-chevron-up');
            $('#menuBar a').each(function () {
                var aHref = this.href.split('#');
                aHref[0] += '&' + window.gSession;
                this.href = aHref.join('#');
            });
            resizeHeight();
        }
    };
    fLoadSelected();

    $(window).resize(function () {
        resizeHeight();
    })
    $(window).load(function () {
        resizeHeight();
    })

    var jForm = $('#formSearch');
    if (jForm.length) {
        jForm.find('.Tel').click(function () {
            var jUl = $(this).next('ul');
            if (!jUl.length) {
                return;
            }
            if (jUl.is(':visible')) {
                jUl.hide();
            } else {
                $('.j_selects').hide();
                jUl.show();
            }
        });

        $(document).on("click", function (e) {
            var target = e.target;
            if ($(target).closest(".state").length == 0) {
                $(".j_selects").hide();
            }
            if ($(target).closest(".j_selects").find("li").length > 0) {
                $(".j_selects").hide();
            }
        })

        jForm.find('li').click(function () {
            var jThis = $(this);
            var jUl = jThis.parent();
            jUl.next('input').val(jThis.attr('data-id'));
            jUl.prev().html(jThis.html());
            jUl.hide();
        });

        jForm.find('ul').each(function () {
            var jThis = $(this);
            var sId = $.trim(jThis.next('input').val());
            var jLi;
            if (sId.length) {
                jLi = jThis.find('li[data-id="' + sId + '"]');
                if (jLi.length) {
                    return jLi.click();
                }
            }
            jThis.find('li:first').click();
        });

        jForm.submit(function () {
            $('<div style="text-align:center;"><img src="public/images/loading.gif" /></div>').insertBefore($(this).hide());
        });
    }
});